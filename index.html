<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=, initial-scale=1.0">
  <title>オセロゲーム</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>
<body>
  <div style="text-align: center;">
    <table class="board">
      <tbody class="body">
      </tbody>
    </table>

    <p>※ ○が先行</p>

    <p id="maru-win" style="display:none; color: red; font-size: 20px;">黒の勝利</p>
    <p id="batu-win" style="display:none; color: red; font-size: 20px;">白の勝利</p>
    <p id="draw" style="display:none; color: red; font-size: 20px;">引き分け</p>
    <p style="margin-top: 30px;">リセットするにはブラウザを更新してください</p>
  </div>

  <script>
    
    $(document).ready(function () {
      //////////////
      // 必要データ
      //////////////
      // 状態
      const black = 1;
      const white = 2;
      const none = 0;
      // 0が未入力、1が黒、2が白
      let current_state = {};
      // ゲーム終了判定
      let is_finish = false;




      
      /////////////
      // 要素作成
      /////////////
      const tbody = $(".body");
      // 初期データ作成
      const make_current_state = (current_state) => {
        for(let i = 0; i < 8; i++) {
          if (i == 3) {
            current_state[i] = [none, none, none, black, white, none, none, none];
          } else if (i == 4) {
            current_state[i] = [none, none, none, white, black, none, none, none];
          } else {
            current_state[i] = [none, none, none, none, none, none, none, none];
          }
        }

        return current_state;
      }
      // 初期データ
      current_state = make_current_state(current_state);
      
      // 要素作成
      Object.keys(current_state).forEach((key) => {
        let tr = $("<tr></tr>").appendTo(tbody);

        current_state[key].forEach((val, k) => {
          let id = key + '-' + k;
          current_state[id] = 0;
          let td = $('<td></td>').appendTo(tr);
          $('<canvas  id="'+id+'" class="canvas" width="70px" height="70px"></canvas>').appendTo(td);


          if (val == black) {
            let ctx = $('#'+id).get(0).getContext("2d");
            ctx.strokeStyle = "black";
            ctx.beginPath();
            ctx.arc(35, 35, 20, 0, 2 * Math.PI);
            ctx.closePath();
            ctx.stroke();
          } else if (val == white) {
            let ctx = $('#'+id).get(0).getContext("2d");
            ctx.strokeStyle = "red";
            ctx.beginPath();
            ctx.arc(35, 35, 20, 0, 2 * Math.PI);
            ctx.closePath();
            ctx.stroke();
          }
        });
      });






      ////////////////////
      // クリックイベント
      ////////////////////
      let count = 0;
      $(".canvas").on("click", (e) => {
        // 終了したら押せない
        if (is_finish) {
          return;
        }

        let id = e.target.id;
        let [vertical, beside] = id.split( '-' );
        // 既に入力済みのマス目は押せない
        if (current_state[vertical][beside] != 0) {
          return;
        }

        count++;

        let ctx = e.target.getContext("2d");
        if (count % 2 == 1) {
          ctx.strokeStyle = "black";
          ctx.beginPath();
          ctx.arc(35, 35, 20, 0, 2 * Math.PI);
          ctx.closePath();
          ctx.stroke();

          current_state[vertical][beside] = 1;
        } else {
          ctx.strokeStyle = "red";
          ctx.beginPath();
          ctx.arc(35, 35, 20, 0, 2 * Math.PI);
          ctx.closePath();
          ctx.stroke();
          current_state[vertical][beside] = 2;
        }



        // 縦の判定


        // 横の判定


        // 斜めの判定

      });



      // 縦の判定


      // 横の判定


      // 斜めの判定
      





      // 勝利判定
      const which_win = (current_state) => {
        win_patterns.forEach(pattern => {
          let square_value1 = pattern[0];
          let square_value2 = pattern[1];
          let square_value3 = pattern[2];
          if (current_state[square_value1] == 1 && current_state[square_value2] == 1 && current_state[square_value3] == 1) {
            is_finish = true;
            $("#maru-win").show();
            return;
          } else if (current_state[square_value1] == 2 && current_state[square_value2] == 2 && current_state[square_value3] == 2) {
            is_finish = true;
            $("#batu-win").show();
            return;
          }
        });


        return false;
      }
    });




  </script>
</body>
</html>