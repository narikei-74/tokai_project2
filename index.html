<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=, initial-scale=1.0">
  <title>オセロゲーム</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>
<body>
  <div style="text-align: center;">
    <table class="board">
      <tbody class="body">
      </tbody>
    </table>

    <p>※ ○が先行</p>

    <p id="maru-win" style="display:none; color: red; font-size: 20px;">○の勝利</p>
    <p id="batu-win" style="display:none; color: red; font-size: 20px;">✖️の勝利</p>
    <p id="draw" style="display:none; color: red; font-size: 20px;">引き分け</p>
    <p style="margin-top: 30px;">リセットするにはブラウザを更新してください</p>
  </div>

  <script>
    
    $(document).ready(function () {
      // 縦マス数
      const vertical_square_length = 3;
      // 横マス数
      const lateral_square_length = 3;
      // 全マス数
      const all_square_length = 9;
      // 判定用配列
      // 0が未入力、1が◯、2が✖️
      let current_state = [];
      // 勝利パターン
      const win_patterns = [
        [1, 2, 3],
        [4, 5, 6],
        [7, 8, 9],
        [1, 4, 7],
        [2, 5, 8],
        [3, 6, 9],
        [1, 5, 9],
        [3, 5, 7]
      ];
      // ゲーム終了判定
      let is_finish = false;






      // 要素作成
      const tbody = $(".body");

      for(let i = 0; i < vertical_square_length; i++) {
        let tr = $("<tr></tr>").appendTo(tbody);

        for(let k = 1; k <= lateral_square_length; k++) {
          let id = k + (lateral_square_length * i);
          current_state[id] = 0;
          let td = $('<td></td>').appendTo(tr);
          $('<canvas  id="'+id+'" class="canvas" width="100%" height="100%"></canvas>').appendTo(td);
        }
      }







      // イベント
      let count = 0;
      $(".canvas").on("click", (e) => {
        // 終了したら押せない
        if (is_finish) {
          return;
        }

        let id = e.target.id;
        // 既に入力済みのマス目は押せない
        if (current_state[id] != 0) {
          return;
        }

        count++;

        let ctx = e.target.getContext("2d");

        if (count % 2 == 1) {
          ctx.strokeStyle = "black";
          ctx.beginPath();
          ctx.arc(50, 50, 30, 0, 2 * Math.PI);
          ctx.closePath();
          ctx.stroke();

          current_state[id] = 1;
        } else {
          ctx.beginPath();
          ctx.moveTo(25, 25);
          ctx.lineTo(75, 75);
          ctx.moveTo(25, 75);
          ctx.lineTo(75, 25);
          ctx.stroke();
          current_state[id] = 2;
        }

        which_win(current_state);
  
        if (count == all_square_length && !is_finish) {
          $("#draw").show();
          is_finish = true;
        }

      });





      // 勝利判定
      const which_win = (current_state) => {
        win_patterns.forEach(pattern => {
          let square_value1 = pattern[0];
          let square_value2 = pattern[1];
          let square_value3 = pattern[2];
          if (current_state[square_value1] == 1 && current_state[square_value2] == 1 && current_state[square_value3] == 1) {
            is_finish = true;
            $("#maru-win").show();
            return;
          } else if (current_state[square_value1] == 2 && current_state[square_value2] == 2 && current_state[square_value3] == 2) {
            is_finish = true;
            $("#batu-win").show();
            return;
          }
        });


        return false;
      }
    });




  </script>
</body>
</html>